/*
 * communication.c
 *
 *  Created on: ??þ/??þ/????
 *      Author: ASHRY
 */
#include "stm32f4xx_hal.h"
#include "stm32f4xx_hal_gpio.h"
#include "stm32f4xx_hal_spi.h"
#include "./communication.h"

SPI_HandleTypeDef hspi2 = {0};
void communicationVidInit(){
	// initialize GPIO PINS to its alternate function
	GPIO_InitTypeDef GPIO_InitStruct = {0};
	GPIO_InitStruct.Pin = SCLK_PIN | MISO_PIN | MOSI_PIN;
	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
	GPIO_InitStruct.Alternate = SPI_ALTERNATE_FUNCTION;
	HAL_GPIO_Init(SPI_PORT, &GPIO_InitStruct);

	//initialize ss pin  as output and trigger pin as input
	GPIO_InitStruct.Pin = SS_PIN;
	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(SPI_PORT, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = TRIGGER_PIN;
	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
	HAL_GPIO_Init(SPI_PORT, &GPIO_InitStruct)
}
void communicationVidSelectSlave(){
	HAL_GPIO_WritePin(SPI_PORT, SS_PIN, GPIO_PIN_RESET);
}
void communicationVidDeselectSlave(){
	while (HAL_SPI_GetState(&hspi2) != HAL_SPI_STATE_READY);
	HAL_GPIO_WritePin(SPI_PORT, SS_PIN, GPIO_PIN_RESET);
}
uint8_t communicationCharGetTriggerPinValue(){
	return HAL_GPIO_ReadPin(SPI_PORT, TRIGGER_PIN);
}
