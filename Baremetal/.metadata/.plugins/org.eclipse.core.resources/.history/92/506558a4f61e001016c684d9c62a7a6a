/*
 * trnsmission.c
 *
 *  Created on: ??þ/??þ/????
 *      Author: ASHRY
 */
#include "stm32f4xx_hal.h"
#include "stm32f4xx_hal_spi.h"
#include <string.h>
#include "../typesdefinition/typedefinitions.h"
#include "../formatter/serialization.h"
#include "./transmission.h"
extern SPI_HandleTypeDef hspi2;
void transmissionVidSendSensorData(sensorTypeDef*sensorData){
    uint8_t packet[SENSOR_DATA_SIZE + 2];  // 1 byte start + 8 byte data + 1 byte end

    packet[0] = START_FRAME;

    uint8_t* serialized = serializeSensorData(sensorData);  // returns 9 bytes (ID + float)
    memcpy(&packet[1], serialized, SENSOR_DATA_SIZE);

    packet[SENSOR_DATA_SIZE + 1] = END_FRAME;

    HAL_SPI_Transmit_DMA(&hspi2, packet, SENSOR_DATA_SIZE + 2);
}

